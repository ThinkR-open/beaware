---
title: "exploration"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{exploration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(beaware)
library(ps)
library(purrr)
library(dplyr)
library(stringr)
```

<!--

# Description of your package

This will fill the description of your package.
--> 


# Read data

<!-- Store your dataset in a directory named "inst/" at the root of your project -->
<!-- Use it for your tests in this Rmd thanks to `load_all()` to make it available
and `system.file()` to read it in your examples 
-->


# Récupérer les informations pour monitorer

```{r}
ok <- ps() %>% 
  filter(stringr::str_detect(name , "^rsession$"))

### il manque le pourcentage CPU et MEM

test <- system("ps -C rsession -o 'pid,%cpu,%mem'", intern = TRUE) %>% 
  str_replace_all("\\s+", " ") %>%
  str_trim() %>% 
  str_split(" ") 


ok_bis <- map_df(test[-1], ~ set_names(.x, tolower(test[[1]])) ) %>% 
  mutate_at(c("pid", "%mem", "%cpu"), as.numeric)


mem_cpu <- left_join(ok, ok_bis, by = "pid") 

## Avoir la version de R
  
map_df(ok$pid, function(x){
  cmd <- paste0("cat /proc/",x,"/environ")
  r_version <- system(cmd, intern = TRUE) %>% 
    str_extract(".+/R/(.+\\d.\\d.\\d|\\d.\\d.\\d)") %>% 
    str_extract("\\d.\\d.\\d")
  data.frame("pid" = x, r_version = r_version)
}) %>% 
  right_join(x = mem_cpu, by = "pid")

```

```{r examples}
get_process_rsession()
```

# Get cpu and mem info

```{r examples-2}
get_mem_cpu()
```

```{r examples-3}
pids <- get_process_rsession()
get_r_version(pids$pid)
```

# There can be development actions

These will be included in the `dev_history.R` file of your package, but won't be direct part of it.


# Inflate your package

You're one inflate from paper to box.
Build your package from this very Rmd using `fusen::inflate()`

- Verify your `"DESCRIPTION"` file has been updated
- Verify your function is in `"R/"` directory
- Verify your test is in `"tests/testthat/"` directory
- Verify this Rmd appears in `"vignettes/"` directory
